<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒ”ã‚¢ãƒæ¨å¥¨ä¿®ç†ææ¡ˆã‚·ã‚¹ãƒ†ãƒ ãƒ»å®Œå…¨ç¶²ç¾…ç‰ˆ</title>
    <style>
        :root { --main-blue: #004098; --bg-color: #f4f7f9; --save-green: #2e7d32; }
        body { font-family: "MS UI Gothic", sans-serif; margin: 0; padding: 20px; background: var(--bg-color); }
        .no-print { max-width: 1100px; margin: 0 auto 30px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .setup-box { background: #eef2f7; padding: 15px; border-radius: 6px; border-left: 5px solid var(--main-blue); margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; cursor: pointer; border: none; background: #ddd; }
        .tab-btn.active { background: var(--main-blue); color: white; }
        .edit-table { width: 100%; border-collapse: collapse; font-size: 11px; margin-top: 10px; }
        .edit-table th, .edit-table td { border: 1px solid #ccc; padding: 4px; }
        .edit-table textarea { width: 100%; height: 50px; resize: vertical; }
        .print-area { background: white; width: 210mm; min-height: 297mm; margin: 0 auto; padding: 15mm; box-sizing: border-box; }
        .proposal-table { width: 100%; border-collapse: collapse; margin-top: 20px; table-layout: fixed; }
        .proposal-table th, .proposal-table td { border: 1px solid #000; padding: 8px; font-size: 12px; line-height: 1.4; word-wrap: break-word; }
        .proposal-table th { background: #f2f2f2; }
        .price-input { width: 90%; border: 1px dotted #ccc; text-align: right; background: transparent; }
        .desc-edit { width: 100%; border: none; font-family: inherit; font-size: inherit; resize: none; background: transparent; overflow: hidden; width: 100%; }
        .admin-btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; margin-right: 5px; }
        @media print { .no-print { display: none !important; } .print-area { margin: 0; width: 100%; border: none; padding: 0; } .price-input { border: none; } }
    </style>
</head>
<body>

<div class="no-print">
    <h1>ãƒ”ã‚¢ãƒæ¨å¥¨ä¿®ç†ææ¡ˆã‚·ã‚¹ãƒ†ãƒ </h1>
    <div style="margin-bottom: 10px;">
        <button id="tab-p" class="tab-btn active" onclick="switchTab('proposal')">1. ææ¡ˆæ›¸ä½œæˆ</button>
        <button id="tab-m" class="tab-btn" onclick="switchTab('master')">2. ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç®¡ç†</button>
    </div>

    <div id="view-proposal">
        <div class="setup-box">
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <select id="type-select" onchange="updateDropdown()" style="width:120px; padding:8px;">
                    <option value="GP">GPç”¨</option>
                    <option value="UP">UPç”¨</option>
                </select>
                <select id="master-select" style="flex: 2; padding:8px;"></select>
                <button onclick="addFromMaster()" style="padding: 10px 20px; background: var(--main-blue); color: white; border: none; cursor: pointer; border-radius: 4px;">è¿½åŠ </button>
            </div>
            <input type="text" id="cust-input" placeholder="ãŠå®¢æ§˜åã‚’å…¥åŠ›" style="width: 300px; padding: 8px;">
        </div>
        <button onclick="window.print()" style="background: #f57c00; color: white; padding: 15px; border: none; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px;">ææ¡ˆæ›¸ã‚’å°åˆ· / PDFä¿å­˜</button>
    </div>

    <div id="view-master" style="display: none;">
        <div class="setup-box" style="border-left-color: var(--save-green);">
            <h3>ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°</h3>
            <div style="margin: 15px 0;">
                <button onclick="addNewMasterRow()" class="admin-btn" style="background:#666;">ï¼‹ è¡Œè¿½åŠ </button>
                <button onclick="downloadUpdatedHTML()" class="admin-btn" style="background:var(--save-green);">ğŸ’¾ HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãå‡ºã—</button>
            </div>
            <table class="edit-table">
                <thead><tr><th>ç¨®åˆ¥</th><th>é …ç›®å</th><th>èª¬æ˜</th><th>No</th><th>æ¶ˆ</th></tr></thead>
                <tbody id="master-edit-body"></tbody>
            </table>
        </div>
    </div>
</div>

<div class="print-area">
    <div style="text-align: center; border-bottom: 2px solid #000; margin-bottom: 20px;"><h1 style="margin: 0; font-size: 18px;">ç’°å¢ƒåŠã³çµŒå¹´åŠ£åŒ–ã¸ã®å¯¾å¿œï¼ˆæ¨å¥¨ä¿®ç†ã®ã”æ¡ˆå†…ï¼‰</h1></div>
    <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:15px;">
        <h2 id="view-cust" style="border-bottom: 1px solid #000; min-width: 250px; margin: 0;">ï¼¿ï¼¿ï¼¿ï¼¿ æ§˜</h2>
        <div style="font-size: 12px;">ä½œæˆæ—¥: <span id="view-date"></span></div>
    </div>
    <table class="proposal-table">
        <thead><tr><th style="width:25%;">æ¨å¥¨ã•ã‚Œã‚‹å‡¦ç†ãƒ»é …ç›®</th><th style="width:45%;">å†…å®¹èª¬æ˜ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ</th><th style="width:10%;">No</th><th style="width:20%;">æ¦‚ç®—è²»ç”¨(ç¨è¾¼)</th><th class="no-print" style="width:40px;">æ¶ˆ</th></tr></thead>
        <tbody id="proposal-body"></tbody>
    </table>
</div>

<script>
const defaultMaster = [
  /* --- GP ãƒãƒ³ãƒãƒ¼äº¤æ› --- */
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ›(ã‚·ãƒ£ãƒ³ã‚¯ä»˜) A1R/A1L/A1S/A1/EA1/Z1 1å°","desc":"å°‚ç”¨ãƒãƒ³ãƒãƒ¼ã‚’ã‚·ãƒ£ãƒ³ã‚¯æ¯äº¤æ›ã€‚å°å‹ãªãŒã‚‰åŠ›å¼·ã„éŸ¿ãã‚’å†ç”Ÿã—ã¾ã™ã€‚","no":"1-11"},
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ›(ã‚·ãƒ£ãƒ³ã‚¯ä»˜) C1/C1L/C1X/GC1 1å°","desc":"è¨­è¨ˆã«æœ€é©åŒ–ã•ã‚ŒãŸãƒãƒ³ãƒãƒ¼ã§ã€ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„æ˜ç­ãªéŸ³è‰²ã‚’å¾©æ´»ã•ã›ã¾ã™ã€‚","no":"1-11"},
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ›(ã‚·ãƒ£ãƒ³ã‚¯ä»˜) C2/C2L/C2X 1å°","desc":"ä¸­å‹ãƒ¢ãƒ‡ãƒ«ã®è±Šã‹ãªéŸ¿ãã‚’æ”¯ãˆã‚‹é«˜å“è³ªãƒãƒ³ãƒãƒ¼ã¸ã¨åˆ·æ–°ã—ã¾ã™ã€‚","no":"1-11"},
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ›(ã‚·ãƒ£ãƒ³ã‚¯ä»˜) C3/C3L/C3X/C3AE 1å°","desc":"ä¸»åŠ›ãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¾åŠ›ã‚’æœ€å¤§é™ã«å¼•ãå‡ºã™ãŸã‚ã€å³é¸ã•ã‚ŒãŸãƒãƒ³ãƒãƒ¼ã¸ä¸€æ–°ã—ã¾ã™ã€‚","no":"1-11"},
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ›(ã‚·ãƒ£ãƒ³ã‚¯ä»˜) C5/C5L/C5X 1å°","desc":"æ·±ã¿ã®ã‚ã‚‹éŸ³è‰²ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€å¼¾åŠ›æ€§ã«å„ªã‚ŒãŸæ–°å“ãƒãƒ³ãƒãƒ¼ã¸äº¤æ›ã—ã¾ã™ã€‚","no":"1-11"},
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ›(ã‚·ãƒ£ãƒ³ã‚¯ä»˜) C6/C7/C6X/C7X 1å°","desc":"å¤§å‹ãƒ¢ãƒ‡ãƒ«ç‰¹æœ‰ã®é‡åšãªéŸ¿ãã‚’æ”¯ãˆã‚‹é«˜å“è³ªãªãƒãƒ³ãƒãƒ¼ã¸ã¨åˆ·æ–°ã—ã¾ã™ã€‚","no":"1-11"},
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ›(ã‚·ãƒ£ãƒ³ã‚¯ä»˜) S4/S400B/S4B 1å°","desc":"ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¢ãƒ‡ãƒ«å°‚ç”¨ã®ç²¾å¯†ãªãƒãƒ³ãƒãƒ¼ã«ã‚ˆã‚Šã€è‡³é«˜ã®ã‚¿ãƒƒãƒã‚’å†ç¾ã—ã¾ã™ã€‚","no":"1-11"},
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ›(ã‚·ãƒ£ãƒ³ã‚¯ä»˜) S6/S600B/S6B 1å°","desc":"æ¼”å¥å®¶ã®è¦æ±‚ã«å¿œãˆã‚‹é«˜å“ä½ãƒãƒ³ãƒãƒ¼ã«ã‚ˆã‚Šã€åœ§å€’çš„ãªéŸ¿ãã‚’å†ç”Ÿã—ã¾ã™ã€‚","no":"1-11"},
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ›(ã‚·ãƒ£ãƒ³ã‚¯ä»˜) CF/CF3/CF3S/CFX 1å°","desc":"æœ€é«˜å³°ã®æ¼”å¥ã«å¿œãˆã‚‹ãŸã‚ã€æ¥µã‚ã¦ç²¾åº¦ã®é«˜ã„ãƒãƒ³ãƒãƒ¼ã¸ã¨åˆ·æ–°ã—ã¾ã™ã€‚","no":"1-11"},
  /* --- GP ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ»éµç›¤ --- */
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼æ•´å½¢ 1å°","desc":"å¼¦è·¡ã«ã‚ˆã‚‹éŸ³ã®ç¡¬ã•ã‚’å‰Šã‚Šå–ã‚Šã€ç™ºéŸ³ã‚’ã‚¯ãƒªã‚¢ã«ã—ã¾ã™ã€‚","no":"1"},
  {"type":"GP","name":"ãƒãƒ³ãƒãƒ¼ã‚·ãƒ£ãƒ³ã‚¯ASSYäº¤æ› C1ï½C5 1å°","desc":"ãƒ•ãƒ¬ãƒ³ã‚¸ã‚’å«ã‚€ã‚·ãƒ£ãƒ³ã‚¯å…¨ä½“ã‚’äº¤æ›ã€‚ã‚¿ãƒƒãƒã®ãƒãƒ©ãƒ„ã‚­ã‚’è§£æ¶ˆã—ã¾ã™ã€‚","no":"5-11"},
  {"type":"GP","name":"ã‚µãƒãƒ¼ãƒˆAssyäº¤æ› 1å°","desc":"é€£æ‰“ã®è¦ã§ã‚ã‚‹ãƒ¬ãƒšãƒ†ã‚£ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã‚’ä¸€æ–°ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚","no":"20-40"},
  {"type":"GP","name":"ã‚»ãƒ³ã‚¿ãƒ¼ãƒ”ãƒ³å–æ›¿ 1å°","desc":"é–¢ç¯€éƒ¨ã®æ‘©æ“¦ã‚’é©æ­£åŒ–ã€‚æˆ»ã‚Šä¸è‰¯ã‚„ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã‚’è§£æ¶ˆã—ã¾ã™ã€‚","no":"10"},
  {"type":"GP","name":"ãƒ•ãƒ­ãƒ³ãƒˆãƒ–ãƒƒã‚·ãƒ³ã‚°ã‚¯ãƒ­ã‚¹è²¼ã‚Šæ›ãˆ 1å°","desc":"éµç›¤ã®å·¦å³ã‚¬ã‚¿ã¤ãã‚’æŠ‘ãˆã€æŒ‡å…ˆã®åŠ›ã‚’æ­£ç¢ºã«ä¼ãˆã¾ã™ã€‚","no":"67"},
  {"type":"GP","name":"ãƒãƒ©ãƒ³ã‚¹ãƒ–ãƒƒã‚·ãƒ³ã‚°ã‚¯ãƒ­ã‚¹è²¼ã‚Šæ›ãˆ 1å°","desc":"éµç›¤ã®æ”¯ç‚¹ã‚’å®‰å®šã•ã›ã€æ­£ç¢ºãªã‚¿ãƒƒãƒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚","no":"68"},
  {"type":"GP","name":"ç™½éµè²¼ã‚Šæ›ãˆ(ã‚¢ã‚¯ãƒªãƒ©ã‚¤ãƒˆ) 1å°","desc":"å¤‰è‰²ã‚„ãƒ’ãƒ“ã‚’è§£æ¶ˆã—ã€æ¸…æ½”æ„Ÿã¨æŒ‡ãªã˜ã¿ã®è‰¯ã„è³ªæ„Ÿã«ã—ã¾ã™ã€‚","no":"85"},
  {"type":"GP","name":"è±¡ç‰™è²¼ã‚Šæ›ãˆ 1å°","desc":"å¤©ç„¶ç´ æã«ã‚ˆã‚‹å¸æ¹¿æ€§ã¨ç‹¬ç‰¹ã®ã‚¿ãƒƒãƒæ„Ÿã‚’ç¶­æŒã—ã¾ã™ã€‚","no":"84"},
  {"type":"GP","name":"é»’æª€è²¼ã‚Šæ›ãˆ 1å°","desc":"å¤©ç„¶é»’æª€ã‚’ä½¿ç”¨ã—ã€æ»‘ã‚Šã«ããé‡åšãªè³ªæ„Ÿã®é»’éµã«ä»•ä¸Šã’ã¾ã™ã€‚","no":"83"},
  /* --- GP å¼¦ãƒ»ãƒšãƒ€ãƒ«ãƒ»æœ¬ä½“ --- */
  {"type":"GP","name":"å·»ç·šå¼µæ›¿ G1ï½C3 1å°","desc":"ä½éŸ³ã®ã€Œã†ãªã‚Šã€ã‚’è§£æ¶ˆã—ã€æ·±ã„éŸ¿ãã‚’è˜‡ã‚‰ã›ã¾ã™ã€‚","no":"32"},
  {"type":"GP","name":"èŠ¯ç·šå¼µæ›¿ C3ãƒ»5 1å°","desc":"é‡‘å±ç–²åŠ´ã—ãŸå¼¦ã‚’åˆ·æ–°ã—ã€é€æ˜æ„Ÿã®ã‚ã‚‹éŸ¿ãã‚’å–ã‚Šæˆ»ã—ã¾ã™ã€‚","no":"31"},
  {"type":"GP","name":"ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ”ãƒ³äº¤æ› 1å°","desc":"ãƒ”ãƒ³ã®ä¿æŒåŠ›ã‚’å‘ä¸Šã•ã›ã€èª¿å¾‹ã®å®‰å®šæ€§ã‚’é«˜ã‚ã¾ã™ã€‚","no":"30"},
  {"type":"GP","name":"ãƒ€ãƒ³ãƒ‘ãƒ¼ãƒ•ã‚§ãƒ«ãƒˆè²¼ã‚Šæ›ãˆ 1å°","desc":"æ­¢éŸ³ä¸è‰¯ã‚’è§£æ¶ˆã—ã€ã‚¯ãƒªã‚¢ãªæ¼”å¥ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚","no":"50"},
  {"type":"GP","name":"ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚° GPé»’å¡—ã‚Š","desc":"å¤–è£…ã®æ±šã‚Œã‚„ãã™ã¿ã‚’ç£¨ãä¸Šã’ã€æœ¬æ¥ã®å…‰æ²¢ã‚’è˜‡ã‚‰ã›ã¾ã™ã€‚","no":"-"},
  /* --- UPå…¨èˆ¬ --- */
  {"type":"UP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ› 1å° (121cmä»¥ä¸‹)","desc":"ç¡¬åŒ–ã—ãŸãƒãƒ³ãƒãƒ¼ã‚’äº¤æ›ã€‚æ˜ã‚‹ãèŠ¯ã®ã‚ã‚‹éŸ³è‰²ã‚’å†ç”Ÿã—ã¾ã™ã€‚","no":"56-57"},
  {"type":"UP","name":"ãƒãƒ³ãƒãƒ¼äº¤æ› 1å° (131cmä»¥ä¸Š)","desc":"å¤§å‹ãƒ¢ãƒ‡ãƒ«ã®è±Šã‹ãªéŸ¿ãã‚’æ”¯ãˆã‚‹é«˜å“è³ªãƒãƒ³ãƒãƒ¼ã¸ä¸€æ–°ã—ã¾ã™ã€‚","no":"56-57"},
  {"type":"UP","name":"ãƒãƒƒãƒˆã‚¹ãƒ—ãƒªãƒ³ã‚°ã‚³ãƒ¼ãƒ‰å–æ› 1å°","desc":"çµŒå¹´åŠ£åŒ–ã§åˆ‡ã‚Œã‚„ã™ã„ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šæ›ãˆã€æˆ»ã‚Šä¸è‰¯ã‚’é˜²ãã¾ã™ã€‚","no":"60"},
  {"type":"UP","name":"ãƒ–ãƒ©ã‚¤ãƒ‰ãƒ«ãƒ†ãƒ¼ãƒ—å–æ› 1å°","desc":"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®é€£å‹•æ€§ã‚’é«˜ã‚ã€é€£æ‰“æ€§èƒ½ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚","no":"21"},
  {"type":"UP","name":"ã‚»ãƒ³ã‚¿ãƒ¼ãƒ”ãƒ³å–æ›¿ 1å°","desc":"é–¢ç¯€éƒ¨ã®ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã‚’è§£æ¶ˆã—ã€ã‚¹ãƒ ãƒ¼ã‚ºãªå‹•ãã«æˆ»ã—ã¾ã™ã€‚","no":"10"},
  {"type":"UP","name":"ãƒ€ãƒ³ãƒ‘ãƒ¼ãƒ¬ãƒãƒ¼ãƒ•ãƒ¬ãƒ³ã‚¸ã‚³ãƒ¼ãƒ‰å–æ› 1å°","desc":"æ­¢éŸ³æ©Ÿæ§‹ã®å‹•ä½œã‚’æ­£å¸¸åŒ–ã—ã€éŸ³ã®æ¿ã‚Šã‚’è§£æ¶ˆã—ã¾ã™ã€‚","no":"61"},
  {"type":"UP","name":"ãƒãƒ•ãƒ©ãƒ¼ãƒ•ã‚§ãƒ«ãƒˆäº¤æ› 1å°","desc":"å¼±éŸ³æ™‚ã®éŸ³è‰²ã‚’å¿ƒåœ°ã‚ˆã„æŸ”ã‚‰ã‹ã•ã«æ•´ãˆã¾ã™ã€‚","no":"12"},
  {"type":"UP","name":"ãƒ•ãƒ­ãƒ³ãƒˆãƒ–ãƒƒã‚·ãƒ³ã‚°ã‚¯ãƒ­ã‚¹è²¼æ› 1å°","desc":"éµç›¤ã®éŠã³ã‚’é©æ­£åŒ–ã—ã€å®‰å®šã—ãŸã‚¿ãƒƒãƒã‚’å†ç”Ÿã—ã¾ã™ã€‚","no":"27"},
  {"type":"UP","name":"å·»ç·šå¼µæ›¿ 1å°","desc":"éŒ†ã³ãŸä½éŸ³å¼¦ã‚’å¼µã‚Šæ›¿ãˆã€é‡åšãªéŸ¿ãã‚’å¾©æ´»ã•ã›ã¾ã™ã€‚","no":"32"},
  {"type":"UP","name":"å¤–è£…ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°(UPé»’å¡—ã‚Š)","desc":"å°‚é–€ã®ç£¨ãå·¥ç¨‹ã§å¤–è£…ã®é¡é¢å…‰æ²¢ã‚’å†ç”Ÿã—ã¾ã™ã€‚","no":"ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°"}
];

let myData = [...defaultMaster];

function switchTab(tab) {
    document.getElementById('view-proposal').style.display = tab === 'proposal' ? 'block' : 'none';
    document.getElementById('view-master').style.display = tab === 'master' ? 'block' : 'none';
    document.getElementById('tab-p').className = 'tab-btn' + (tab === 'proposal' ? ' active' : '');
    document.getElementById('tab-m').className = 'tab-btn' + (tab === 'master' ? ' active' : '');
    if(tab === 'master') renderMasterEditor();
}

function renderMasterEditor() {
    const body = document.getElementById('master-edit-body');
    body.innerHTML = '';
    myData.forEach((item, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><select onchange="myData[${idx}].type=this.value"><option value="GP" ${item.type==='GP'?'selected':''}>GP</option><option value="UP" ${item.type==='UP'?'selected':''}>UP</option></select></td>
            <td><input type="text" value="${item.name}" onchange="myData[${idx}].name=this.value" style="width:95%"></td>
            <td><textarea onchange="myData[${idx}].desc=this.value">${item.desc||''}</textarea></td>
            <td><input type="text" value="${item.no}" onchange="myData[${idx}].no=this.value" style="width:90%"></td>
            <td><button onclick="myData.splice(${idx},1); renderMasterEditor();">Ã—</button></td>
        `;
        body.appendChild(tr);
    });
}

function downloadUpdatedHTML() {
    const dataString = JSON.stringify(myData, null, 2);
    let htmlContent = document.documentElement.outerHTML;
    htmlContent = htmlContent.replace(/const defaultMaster = \[[\s\S]*?\];/, `const defaultMaster = ${dataString};`);
    const blob = new Blob([htmlContent], { type: 'text/html' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'piano_system_full.html';
    a.click();
}

function updateDropdown() {
    const type = document.getElementById('type-select').value;
    const select = document.getElementById('master-select');
    select.innerHTML = '';
    myData.filter(d => d.type === type).forEach(item => {
        const opt = document.createElement('option');
        opt.value = JSON.stringify(item);
        opt.text = item.name;
        select.appendChild(opt);
    });
}

function addFromMaster() {
    const val = document.getElementById('master-select').value;
    if(!val) return;
    const item = JSON.parse(val);
    const tr = document.createElement('tr');
    tr.innerHTML = `
        <td contenteditable="true">${item.name}</td>
        <td><textarea class="desc-edit" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'">${item.desc||''}</textarea></td>
        <td contenteditable="true" style="text-align:center">${item.no}</td>
        <td>Â¥ <input type="text" class="price-input" placeholder="0,000"></td>
        <td class="no-print" style="text-align:center"><button onclick="this.closest('tr').remove()" style="color:red; border:none; background:none; cursor:pointer;">Ã—</button></td>
    `;
    document.getElementById('proposal-body').appendChild(tr);
    const ta = tr.querySelector('textarea');
    ta.style.height = ta.scrollHeight + 'px';
}

function addNewMasterRow() {
    myData.unshift({type: "GP", name: "", desc: "", no: ""});
    renderMasterEditor();
}

window.onload = () => {
    updateDropdown();
    document.getElementById('view-date').innerText = new Date().toLocaleDateString();
};

document.getElementById('cust-input').oninput = function() {
    document.getElementById('view-cust').innerText = (this.value || "ï¼¿ï¼¿ï¼¿ï¼¿") + " æ§˜";
};
</script>
</body>
</html>
